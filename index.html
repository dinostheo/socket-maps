<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Socket Map</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyB3ZvnfCiGyhrBw1mGQ6QFRVkyy2Jwa6Bw&sensor=true"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/flick/jquery-ui.css" />
    <script>
      var geocoder;
      var map;
      var socket = io.connect(window.location.hostname);
      // var socket = io.connect('http://localhost:3000');

      socket.on('message', function (data) {
        data = data.replace("(", "");
        data = data.replace(")", "");
        data = data.replace(" ", "");
        data = data.split(",");
        msg = new google.maps.LatLng(data[0], data[1]);
        addMarker(msg);
      });

      function initialize() {
        var mapOptions = {
          zoom: 8,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          center: new google.maps.LatLng(0.0,0.0),
        };
        map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
        geocoder = new google.maps.Geocoder();
      }

      function codeAddress() {
        var address = document.getElementById('address').value;
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            var msg = results[0].geometry.location;
          setTimeout(function() {
              addMarker(msg);
              socket.send(msg);
          }, 200);
          } else {
            alert("Unknown location...");
          }
        });
      }

      function addMarker(msg){
        map.setCenter(msg);
      var marker = new google.maps.Marker({
          position: msg,
          map: map,
          draggable: false,
          animation: google.maps.Animation.DROP,
      });
      }
    </script>
    <style>
    #map_canvas {
      width: 600px;
      height: 310px;
      border: 1px solid black;
      position: absolute;
    }
  </style>
  </head>
  <body onload="initialize()">
    <div>
      <input id="address" type="textbox" value="">
      <button id="location_button" onclick="codeAddress()">Place a marker</button>
    </div>
    <div>
      <h2>Socket map:</h2>
    </div>
    <div id="map_canvas">
    </div>
  </body>
</html>